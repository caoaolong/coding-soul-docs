### 线程调度之主动让权

![线程调度之主动让权](../images/线程调度-主动让权.svg)

---

这张图描述了一个任务调度系统中的任务管理和调度流程，重点展示了任务队列（`task_queue`）、就绪列表（`ready_list`）、任务列表（`task_list`）、默认任务（`default_task`）以及运行任务（`running_task`）之间的关系和状态变化。以下是分步骤的描述：

---

### 1. **初始化任务列表**
- **任务队列（`task_queue`）**
  - 包含两个列表：
    - **`ready_list`（就绪列表）：** 存储所有准备运行的任务。
    - **`task_list`（任务列表）：** 存储所有任务的完整信息。
  - 任务通过指针连接，表示按顺序调度。
- 此时：
  - **`default_task`** 和 **`running_task`** 均为 `NULL`，即尚未初始化默认任务或当前运行任务。

---

### 2. **初始化默认任务**
- 将 **`default_task`** 初始化为第一个任务（`task1`）。
- **`running_task`** 指向 **`default_task`**。
- 此时，**`default_task`** 和 **`running_task`** 的状态保持一致，指向第一个任务（`task1`），表示当前运行的是默认任务。

---

### 3. **发起调度**
- **调度操作**：
  - 当前运行任务被从 **`ready_list`**（就绪列表）移除。
  - 然后重新插入到队列尾部，完成重新排序。
- **状态变化**：
  - **`running_task`** 仍指向当前正在运行的任务，但任务顺序已更新，确保公平调度。

---

### 4. **切换运行任务**
- 从 **`ready_list`** 中取出第一个任务，将其切换为运行状态。
- **状态变化**：
  - **`running_task`** 更新为从队列中提取的新任务。
  - **`default_task`** 继续保持对初始任务的引用。

---

### 总结
该图直观地展示了任务队列的管理与调度机制：
1. **任务列表（`task_list`）：** 存储任务的完整数据。
2. **就绪列表（`ready_list`）：** 调度中按顺序排列的任务。
3. **任务调度：** 通过任务切换和重新排序确保任务的公平性和资源利用效率。