## 图解远跳转系统调用

![SYSCALL](../images/系统调用.svg)

### **流程解释**

1. **用户态程序发起调用**：
   用户程序通过执行 `lcall` 指令，向内核发起系统调用。

2. **CPU 验证段权限**：
   CPU 根据 `lcall` 指定的段选择子，从 GDT 中读取目标段描述符，并检查 CPL 是否符合段描述符的 DPL。

3. **切换到内核态**：
   如果权限验证通过，CPU 自动切换到内核栈（`TSS:SS0` 和 `TSS:ESP0`）并跳转到内核态系统调用处理程序。

4. **处理系统调用**：
   内核根据系统调用号和参数执行相应逻辑。

5. **返回用户态**：
   内核通过执行 `retf` 指令，恢复用户态的代码段和栈，将控制权交回用户程序。

6. **用户程序继续执行**：
   系统调用完成，用户程序接着执行后续代码。