# 图解FAT16

![FAT16](../images/FAT16.svg)

FAT16（File Allocation Table 16-bit）文件系统是一种早期的文件系统，广泛用于MS-DOS和早期Windows系统。它是一种基于文件分配表（FAT）的文件系统，适用于小型存储设备，如软盘、早期硬盘和闪存设备。下面是FAT16的组成结构：

---

## **1. FAT16的基本结构**
FAT16的存储介质通常划分为以下几个部分：
1. **引导扇区（Boot Sector）**
2. **保留扇区（Reserved Sectors）**
3. **文件分配表（File Allocation Table, FAT）**
4. **根目录区（Root Directory Area）**
5. **数据区（Data Area）**

---

## **2. FAT16的各组成部分**
### **(1) 引导扇区（Boot Sector）**
- **作用**：存储分区的基本信息和引导代码，使系统能够识别并加载操作系统。
- **关键字段**：
  - `BPB（BIOS Parameter Block）`：存储文件系统的基本信息，如扇区大小、簇大小、FAT表的个数等。
  - `引导代码（Boot Code）`：用于加载操作系统（如果分区是可引导的）。
  - `分区标志（Boot Signature）`：通常为`0x55AA`，表示这是一个有效的FAT引导扇区。

---

### **(2) 保留扇区（Reserved Sectors）**
- **作用**：紧跟在引导扇区后面，一般只包含引导扇区，默认大小为1扇区（某些系统可能增加备份引导扇区）。
- **特点**：
  - 通常不会存储用户数据。
  - 只有第一个扇区（即引导扇区）存储了重要信息。

---

### **(3) 文件分配表（File Allocation Table, FAT）**
- **作用**：管理文件在磁盘上的存储，记录每个簇的使用情况（空闲、占用、坏簇等）。
- **特点**：
  - FAT16的表项大小为 **16位（2字节）**，因此最多可管理 **65536个簇**（通常小于65536）。
  - 采用链表结构，每个簇存储指向下一个簇的指针，若文件较大，则多个簇通过FAT表链接在一起。
  - FAT16通常有 **两个FAT表**（FAT1和FAT2），第二张是第一张的备份。

- **FAT表的内容**：
  - `0x0000` - 未使用的簇。
  - `0x0001` - 保留值，不使用。
  - `0x0002 - 0xFFEF` - 簇链，指向文件的下一个簇。
  - `0xFFF7` - 坏簇（坏扇区）。
  - `0xFFF8 - 0xFFFF` - 终止标志，表示文件结束。

---

### **(4) 根目录区（Root Directory Area）**
- **作用**：存储根目录下的文件和子目录的目录项。
- **特点**：
  - 目录项大小固定 **32字节**，包含文件名、扩展名、时间戳、文件大小等信息。
  - 根目录区大小是 **固定的**，不像FAT32那样可以动态扩展。
  - 由于采用 **静态分配**，所以FAT16的根目录 **最大支持的文件/目录数量是有限的**（通常为512个）。

- **根目录项的结构**：
  - 8字节文件名 + 3字节扩展名
  - 1字节文件属性（只读、隐藏、系统等）
  - 2字节创建时间、2字节创建日期
  - 2字节文件的起始簇号
  - 4字节文件大小

---

### **(5) 数据区（Data Area）**
- **作用**：存储文件的实际数据。
- **特点**：
  - 由多个簇（Cluster）组成。
  - 每个文件的起始簇号存储在目录项中，后续簇号由FAT表指示。
  - 文件的内容分散在多个簇中，通过FAT表的链表结构进行管理。

---

## **3. FAT16的存储限制**
- **最大支持分区大小**：
  - FAT16 的簇编号使用 16 位存储，因此最多支持 **65536 个簇**。
  - 簇大小通常在 **2KB - 64KB** 之间，因此 **最大支持分区大小为 2GB（64KB × 65536）**。
- **最大单个文件大小**：**2GB**（受限于MS-DOS的API）。
- **最大根目录文件数**：通常为 **512**（根目录区固定）。

---

## **4. FAT16的工作原理**
1. **存储文件**
   - 在根目录或子目录中创建一个目录项。
   - 在FAT表中找到空闲簇，分配给文件。
   - 文件数据存储在数据区的簇中。
   - 如果文件超过一个簇，则FAT表建立簇链。

2. **读取文件**
   - 通过目录项找到文件的 **起始簇**。
   - 通过FAT表的链表查找文件的完整数据。
   - 读取数据区中的文件内容。

3. **删除文件**
   - 在目录项中删除文件名（通常只是标记为删除）。
   - 在FAT表中释放该文件占用的簇。

---

## **5. FAT16与FAT32的对比**
| 特性         | FAT16                  | FAT32                  |
|-------------|----------------------|----------------------|
| 簇编号位数   | 16位                   | 32位                   |
| 最大分区大小 | 2GB                    | 2TB                    |
| 最大单文件大小 | 2GB                    | 4GB                    |
| 根目录大小   | 固定（通常512个目录项） | 可动态扩展            |
| 适用场景     | 早期小型存储设备        | 大容量存储设备        |

---

## **总结**
- FAT16 是一种 **简单高效** 的文件系统，适用于小型存储设备。
- 由 **引导扇区、FAT表、根目录区、数据区** 组成。
- **采用FAT表管理文件存储**，使用链表结构连接簇。
- **存在根目录文件数、分区大小的限制**，在大容量存储中逐渐被FAT32取代。